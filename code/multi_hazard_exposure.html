<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Multi-Hazard Exposure and Urbanization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="multi_hazard_exposure_files/libs/clipboard/clipboard.min.js"></script>
<script src="multi_hazard_exposure_files/libs/quarto-html/quarto.js"></script>
<script src="multi_hazard_exposure_files/libs/quarto-html/popper.min.js"></script>
<script src="multi_hazard_exposure_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="multi_hazard_exposure_files/libs/quarto-html/anchor.min.js"></script>
<link href="multi_hazard_exposure_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="multi_hazard_exposure_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="multi_hazard_exposure_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="multi_hazard_exposure_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="multi_hazard_exposure_files/libs/bootstrap/bootstrap-8a79a254b8e706d3c925cde0a310d4f0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multi-Hazard Exposure and Urbanization</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="op">=</span> gpd.read_file(<span class="st">'../../data/tiberiu/DATA_MH/LAU_2013.shp'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="op">=</span> nuts3[nuts3[<span class="st">'CNTRY'</span>] <span class="op">==</span> <span class="st">'FR'</span> ]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="op">=</span> nuts3.to_crs(epsg<span class="op">=</span><span class="dv">3035</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="op">=</span> nuts3[nuts3.NUTS3_ID<span class="op">==</span><span class="st">'FR712'</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>nuts3[<span class="st">'geometry'</span>] <span class="op">=</span> nuts3.<span class="bu">buffer</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="op">=</span> gpd.read_file(<span class="st">'../../data/tiberiu/DATA_MH/LAU_2013.shp'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="op">=</span> nuts3[nuts3[<span class="st">'CNTRY'</span>] <span class="op">==</span> <span class="st">'FR'</span> ]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>nuts3_agg <span class="op">=</span> nuts3.dissolve(by<span class="op">=</span><span class="st">'NUTS3_ID'</span>, aggfunc<span class="op">=</span><span class="st">'sum'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>nuts3_agg <span class="op">=</span> nuts3_agg.to_crs(epsg<span class="op">=</span><span class="dv">3035</span>)[[<span class="st">'geometry'</span>, <span class="st">'AREAkm'</span>]]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df_nuts3_name <span class="op">=</span> pd.read_excel(<span class="st">'C:/Users/colin/Downloads/Ttypologies and local information corresponding to NUTS3.xls'</span>, sheet_name<span class="op">=</span><span class="st">'NUTS 3 typologies'</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>df_nuts3_name.columns <span class="op">=</span> [<span class="st">'NUTS0'</span>, <span class="st">'NUTS3_ID'</span>, <span class="st">'NUTS3_NAME'</span>, <span class="st">'COASTAL'</span>, <span class="st">'NUTS3_TYPE'</span>] <span class="op">+</span> <span class="bu">list</span>(df_nuts3_name.columns[<span class="dv">5</span>:])</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>df_nuts3_name <span class="op">=</span> df_nuts3_name[[<span class="st">'NUTS3_ID'</span>, <span class="st">'NUTS3_NAME'</span>, <span class="st">'COASTAL'</span>, <span class="st">'NUTS3_TYPE'</span>]]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>nuts3_agg <span class="op">=</span> nuts3_agg.merge(df_nuts3_name, left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, right_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nuts3_agg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NUTS3_ID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">AREAkm</th>
<th data-quarto-table-cell-role="th">NUTS3_NAME</th>
<th data-quarto-table-cell-role="th">COASTAL</th>
<th data-quarto-table-cell-role="th">NUTS3_TYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>FR101</td>
<td>POLYGON ((3765312.525 2887897.170, 3764841.783...</td>
<td>104.921555</td>
<td>FR101 - Paris</td>
<td>N</td>
<td>Urban region</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>FR102</td>
<td>POLYGON ((3766432.461 2808824.030, 3764962.752...</td>
<td>5927.600688</td>
<td>FR102 - Seine-et-Marne</td>
<td>N</td>
<td>Intermediate region</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>FR103</td>
<td>POLYGON ((3721322.492 2847183.767, 3720681.745...</td>
<td>2304.720894</td>
<td>FR103 - Yvelines</td>
<td>N</td>
<td>Urban region</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>FR104</td>
<td>POLYGON ((3739974.709 2830354.959, 3740500.269...</td>
<td>1821.293762</td>
<td>FR104 - Essonne</td>
<td>N</td>
<td>Urban region</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>FR105</td>
<td>POLYGON ((3757443.741 2880225.324, 3757103.459...</td>
<td>174.766629</td>
<td>FR105 - Hauts-de-Seine</td>
<td>N</td>
<td>Urban region</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">91</td>
<td>FR824</td>
<td>MULTIPOLYGON (((3946089.979 2241075.673, 39450...</td>
<td>5250.315551</td>
<td>FR824 - Bouches-du-Rhône</td>
<td>Y</td>
<td>Urban region</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">92</td>
<td>FR825</td>
<td>MULTIPOLYGON (((4014689.280 2218438.989, 40145...</td>
<td>6032.947673</td>
<td>FR825 - Var</td>
<td>Y</td>
<td>Intermediate region</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">93</td>
<td>FR826</td>
<td>MULTIPOLYGON (((3973841.611 2307179.866, 39742...</td>
<td>3577.103564</td>
<td>FR826 - Vaucluse</td>
<td>N</td>
<td>Intermediate region</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">94</td>
<td>FR831</td>
<td>MULTIPOLYGON (((4258944.006 2026890.824, 42587...</td>
<td>4018.235489</td>
<td>FR831 - Corse-du-Sud</td>
<td>Y</td>
<td>Rural region</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>FR832</td>
<td>POLYGON ((4271781.382 2089455.583, 4271678.148...</td>
<td>4710.224474</td>
<td>FR832 - Haute-Corse</td>
<td>Y</td>
<td>Rural region</td>
</tr>
</tbody>
</table>

<p>96 rows × 6 columns</p>
</div>
</div>
</div>
<section id="france-land-use-change" class="level3">
<h3 class="anchored" data-anchor-id="france-land-use-change">France Land-Use Change</h3>
<div id="cell-7" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lu_files <span class="op">=</span> glob.glob(<span class="st">"../../data/Copernicus land-use changes/region_land_use/u2006*.csv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#load all files an dconcatenate them</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df_2006 <span class="op">=</span> pd.concat([pd.read_csv(f) <span class="cf">for</span> f <span class="kw">in</span> lu_files])</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>lu_files <span class="op">=</span> glob.glob(<span class="st">"../../data/Copernicus land-use changes/region_land_use/u2018*.csv"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df_2018 <span class="op">=</span> pd.concat([pd.read_csv(f) <span class="cf">for</span> f <span class="kw">in</span> lu_files])</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>df_2006 <span class="op">=</span> df_2006.sort_values(<span class="st">'LAU_ID'</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>df_2018 <span class="op">=</span> df_2018.sort_values(<span class="st">'LAU_ID'</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>lu_changes <span class="op">=</span> df_2018.copy()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>lu_changes[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]] <span class="op">=</span> df_2018[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]] <span class="op">-</span> df_2006[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>lu_changes[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]] <span class="op">=</span> lu_changes[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]] <span class="op">*</span><span class="dv">100</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>lu_changes <span class="op">=</span> lu_changes.merge(nuts3[[<span class="st">'LAU_ID'</span>, <span class="st">'AREAkm'</span>]], left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Descriptive statistics on land-use changes in France in 2018 the mean county has a land use :</p>
<div id="cell-9" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_2018[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              urban      cropland        forest       wetland
count  36573.000000  36573.000000  36573.000000  36573.000000
mean       0.067371      0.636251      0.286675      0.002186
std        0.121759      0.264349      0.257631      0.017047
min        0.000000      0.000000      0.000000      0.000000
25%        0.008496      0.456928      0.074177      0.000000
50%        0.028003      0.694994      0.212656      0.000000
75%        0.069613      0.857877      0.444365      0.000000
max        1.000000      1.000000      1.000000      0.661261</code></pre>
</div>
</div>
<p>The descriptive statistics of the land-use changes between 2006 and 2018 in France are as follows:</p>
<div id="cell-11" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lu_changes[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              urban      cropland        forest       wetland
count  36573.000000  36573.000000  36573.000000  36573.000000
mean       1.052627     -0.978546     -0.153869      0.004875
std        1.863544      2.335823      1.651806      0.256052
min      -15.108959    -35.682285    -87.161170    -10.732180
25%        0.000000     -1.534855     -0.153584      0.000000
50%        0.347978     -0.409005     -0.001092      0.000000
75%        1.464388     -0.000061      0.011525      0.000000
max       35.710242     82.618764     16.327019     19.062235</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#aggregate at the NUTS3 level</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3_agg.merge(lu_changes[[<span class="st">'NUTS3_ID'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>, <span class="st">'AREAkm'</span>]].groupby(<span class="st">'NUTS3_ID'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(np.average(x[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]], weights<span class="op">=</span>x[<span class="st">'AREAkm'</span>], axis<span class="op">=</span><span class="dv">0</span>), index<span class="op">=</span>[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>])).reset_index(), left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, right_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>nuts3_temp[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]] <span class="op">=</span> nuts3_temp[[<span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].fillna(<span class="dv">0</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.feature <span class="im">as</span> cfeature</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3_temp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>nuts3_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'urban'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Urbanization change (%)"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Urbanization change (%) by NUTS3 region'</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>nuts3_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'cropland'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Cropland change (%)"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Cropland change (%) by NUTS3 region'</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>,<span class="dv">0</span>]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>nuts3_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'forest'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Forest change (%)"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Forest change (%) by NUTS3 region'</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>nuts3_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'wetland'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Wetland change (%)"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Wetland change (%) by NUTS3 region'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\2664727460.py:2: DeprecationWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  nuts3_temp = nuts3_agg.merge(lu_changes[['NUTS3_ID', 'urban', 'cropland', 'forest', 'wetland', 'AREAkm']].groupby('NUTS3_ID').apply(lambda x: pd.Series(np.average(x[['urban', 'cropland', 'forest', 'wetland']], weights=x['AREAkm'], axis=0), index=['urban', 'cropland', 'forest', 'wetland'])).reset_index(), left_on='NUTS3_ID', right_on='NUTS3_ID', how='left')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Text(0.5, 1.0, 'Wetland change (%) by NUTS3 region')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-9-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.feature <span class="im">as</span> cfeature</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3.merge(lu_changes, left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>fig,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>nuts3_temp.plot(column<span class="op">=</span><span class="st">'urban'</span>, legend<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'RdBu_r'</span>, ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="fl">1.2</span>, transform<span class="op">=</span>ccrs.PlateCarree(), legend_kwds<span class="op">=</span>{<span class="st">'orientation'</span>: <span class="st">'horizontal'</span>, <span class="st">'label'</span>: <span class="st">'Urban Change (%)'</span>}, vmax<span class="op">=</span><span class="dv">20</span>, vmin<span class="op">=-</span><span class="dv">20</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>], crs<span class="op">=</span>ccrs.PlateCarree())</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Urban Changes'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Text(0.5, 1.0, 'Urban Changes')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="socio-economic-data" class="level3">
<h3 class="anchored" data-anchor-id="socio-economic-data">Socio-economic data</h3>
<div id="cell-15" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>disp_inc_2015 <span class="op">=</span> gpd.read_file(<span class="st">'../../data/disp_inc_2015.gpkg'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>disp_inc_2015 <span class="op">=</span> disp_inc_2015[disp_inc_2015.ISO<span class="op">==</span><span class="st">'FRA'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>disp_inc_2015[<span class="st">'Population'</span>] <span class="op">=</span> disp_inc_2015[<span class="st">'Population'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>disp_inc_2015[disp_inc_2015.Population<span class="op">&gt;</span>(<span class="dv">100000</span>)]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>lu_changes_socio <span class="op">=</span> lu_changes.copy()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>nuts3 <span class="op">=</span> nuts3.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>disp_inc_2015 <span class="op">=</span> disp_inc_2015.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>disp_centroids <span class="op">=</span> disp_inc_2015.copy()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>disp_centroids[<span class="st">'geometry'</span>] <span class="op">=</span> disp_centroids.centroid</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>nuts3_disp <span class="op">=</span> gpd.sjoin(nuts3, disp_centroids, op<span class="op">=</span><span class="st">'contains'</span>, how<span class="op">=</span><span class="st">'left'</span>).drop_duplicates(subset<span class="op">=</span><span class="st">'COMM_ID'</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>df_urban <span class="op">=</span> pd.merge(nuts3_disp[[<span class="st">'LAU_ID'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>, <span class="st">'Population'</span>]], lu_changes_socio, left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>).drop(columns<span class="op">=</span>[<span class="st">'Unnamed: 0'</span>])</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>df_urban[[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>, <span class="st">'Population'</span>]] <span class="op">=</span> df_urban[[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>, <span class="st">'Population'</span>]].astype(<span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1509125068.py:7: UserWarning: Geometry is in a geographic CRS. Results from 'centroid' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

  disp_centroids['geometry'] = disp_centroids.centroid
c:\Users\colin\anaconda3\envs\xarray_env\Lib\site-packages\IPython\core\interactiveshell.py:3517: FutureWarning: The `op` parameter is deprecated and will be removed in a future release. Please use the `predicate` parameter instead.
  if await self.run_code(code, result, async_=asy):</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_urban[[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>, <span class="st">'Population'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Gini</th>
<th data-quarto-table-cell-role="th">Disp_Inc_PPP_2015</th>
<th data-quarto-table-cell-role="th">Disp_Inc_PPP</th>
<th data-quarto-table-cell-role="th">Population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>32012.000000</td>
<td>32014.000000</td>
<td>32014.000000</td>
<td>3.201100e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.255157</td>
<td>16311.936786</td>
<td>16311.936786</td>
<td>1.162861e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.023227</td>
<td>1780.258812</td>
<td>1780.258812</td>
<td>1.181039e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.169356</td>
<td>10153.344474</td>
<td>10153.344474</td>
<td>7.500000e+01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.242161</td>
<td>15217.701102</td>
<td>15217.701102</td>
<td>2.485000e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.254309</td>
<td>16038.010473</td>
<td>16038.010473</td>
<td>5.165000e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.265959</td>
<td>17038.675761</td>
<td>17038.675761</td>
<td>1.226500e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>0.492333</td>
<td>34105.534118</td>
<td>34105.534118</td>
<td>2.096399e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3_agg.merge(df_urban[[<span class="st">'NUTS3_ID'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>, <span class="st">'Population'</span>]].groupby(<span class="st">'NUTS3_ID'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(np.average(x[[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>]], weights<span class="op">=</span>x[<span class="st">'Population'</span>], axis<span class="op">=</span><span class="dv">0</span>), index<span class="op">=</span>[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>])).reset_index(), left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, right_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3_agg.merge(df_urban[[<span class="st">'NUTS3_ID'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>,<span class="st">'Disp_Inc_PPP'</span>, <span class="st">'Population'</span>]].groupby(<span class="st">'NUTS3_ID'</span>).mean().reset_index(), left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, right_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3_temp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>nuts3_agg <span class="op">=</span> nuts3_agg.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>nuts3_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'Gini'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Gini"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Gini by NUTS3 region'</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>nuts3_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'Disp_Inc_PPP_2015'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Disposible Income PPP 2015"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Disposible Income PPP 2015 by NUTS3 region'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1358748387.py:1: DeprecationWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  nuts3_temp = nuts3_agg.merge(df_urban[['NUTS3_ID', 'Gini', 'Disp_Inc_PPP_2015','Disp_Inc_PPP', 'Population']].groupby('NUTS3_ID').apply(lambda x: pd.Series(np.average(x[['Gini', 'Disp_Inc_PPP_2015','Disp_Inc_PPP']], weights=x['Population'], axis=0), index=['Gini', 'Disp_Inc_PPP_2015','Disp_Inc_PPP'])).reset_index(), left_on='NUTS3_ID', right_on='NUTS3_ID', how='left')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Text(0.5, 1.0, 'Disposible Income PPP 2015 by NUTS3 region')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-14-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We have the following correlations between the socio-economic data and the land-use changes in France between 2006 and 2018:</p>
<div id="cell-20" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(<span class="bu">round</span>(df_urban[[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'Population'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].corr(),<span class="dv">2</span>), annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now we will do it and look at the correlation between Gini and urbanization and Disp_Inc_PPP_2015 and urbanization by NUTS3 region in France.</p>
<div id="cell-22" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_urban.dropna(subset<span class="op">=</span>[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'Population'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr[[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'Population'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>, <span class="st">'NUTS3_ID'</span>]]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr.groupby(<span class="st">'NUTS3_ID'</span>).corr().reset_index()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>nuts_temp <span class="op">=</span> nuts3_agg.merge(df_corr[df_corr[<span class="st">'level_1'</span>]<span class="op">==</span><span class="st">'urban'</span>][[<span class="st">'NUTS3_ID'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>]], left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, right_on <span class="op">=</span> <span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>nuts_temp <span class="op">=</span> nuts_temp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>nuts3_agg <span class="op">=</span> nuts3_agg.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>nuts_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'Gini'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Gini"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Gini correlation with Urban Change'</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>nuts_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'Disp_Inc_PPP_2015'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Disposible Income PPP 2015"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Disposible Income PPP 2015 correlation with Urban Change'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>Text(0.5, 1.0, 'Disposible Income PPP 2015 correlation with Urban Change')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr[df_corr[<span class="st">'level_1'</span>]<span class="op">==</span><span class="st">'urban'</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_corr[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_corr[<span class="st">'NUTS3_ID'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: nuts3_agg[nuts3_agg.NUTS3_ID<span class="op">==</span>x].NUTS3_TYPE.values[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax <span class="op">=</span>ax ,color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>nuts3_agg.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'NUTS3_TYPE'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'bbox_to_anchor'</span>: (<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">'loc'</span>: <span class="st">'upper left'</span>, <span class="st">'title'</span>: <span class="st">'NUTS3 Type'</span>})</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'NUTS3 type'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Text(0.5, 1.0, 'NUTS3 type')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-18-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_corr[[<span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'NUTS3_TYPE'</span>]].groupby(<span class="st">'NUTS3_TYPE'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Gini</th>
<th data-quarto-table-cell-role="th">Disp_Inc_PPP_2015</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">NUTS3_TYPE</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Intermediate region</td>
<td>0.003990</td>
<td>0.241770</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rural region</td>
<td>-0.023764</td>
<td>0.293739</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Urban region</td>
<td>-0.137178</td>
<td>0.084615</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Interesting to see that in the rural regions, the urbanization rate is positively correlated with the disposable income per capita, while in the urban regions, the urbanization rate is negatively correlated with the Gini index. The urbanization rate does not seem to be driven by the same factors in rural and urban regions.</p>
<p><em>Possible explanation:</em> - In rural regions, attracting more people to the region might be a way to increase the disposable income per capita or the reverse might be true, that the increase in disposable income per capita is attracting more people to the region. - In urban regions, much more areas are already urbanized. Urbanization happens in the places where the Gini index is lower, which might be a sign of gentrification.</p>
</section>
<section id="exposition-data-from-spatial-identification-of-regions-exposed-to-multi-hazards-at-the-pan-european-level" class="level3">
<h3 class="anchored" data-anchor-id="exposition-data-from-spatial-identification-of-regions-exposed-to-multi-hazards-at-the-pan-european-level">Exposition Data from <em>Spatial identification of regions exposed to multi-hazards at the pan-European level</em></h3>
<div id="cell-28" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>population_exposed <span class="op">=</span> pd.read_excel(<span class="st">'../../data/tiberiu/DATA_MH/Population%.xlsx'</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>population_exposed <span class="op">=</span> population_exposed[population_exposed[<span class="st">'CNTR_ID'</span>].<span class="bu">str</span>.startswith(<span class="st">'FR'</span>)]    </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>population_exposed <span class="op">=</span> population_exposed.merge(nuts3[[<span class="st">'LAU_ID'</span>, <span class="st">'NUTS3_ID'</span>, <span class="st">'AREAkm'</span>]], left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-29" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>desc <span class="op">=</span> population_exposed[[<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>]].describe()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>desc.iloc[<span class="dv">0</span>] <span class="op">=</span> desc.iloc[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> population_exposed.shape[<span class="dv">0</span>]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>desc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop%_CFL</th>
<th data-quarto-table-cell-role="th">pop%_EQ</th>
<th data-quarto-table-cell-role="th">pop%_FL</th>
<th data-quarto-table-cell-role="th">pop%_LNDSL</th>
<th data-quarto-table-cell-role="th">pop%_SUBS</th>
<th data-quarto-table-cell-role="th">pop%_WUI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>2.663167</td>
<td>13.936511</td>
<td>20.126870</td>
<td>39.080743</td>
<td>65.061658</td>
<td>3.822492</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>18.996411</td>
<td>0.057112</td>
<td>11.538436</td>
<td>12.538501</td>
<td>21.010166</td>
<td>48.221470</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>29.529729</td>
<td>0.158942</td>
<td>18.310732</td>
<td>13.220413</td>
<td>37.675972</td>
<td>34.257396</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.565679</td>
<td>0.000000</td>
<td>0.436418</td>
<td>1.723645</td>
<td>0.000000</td>
<td>12.699130</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>4.392032</td>
<td>0.000000</td>
<td>3.522251</td>
<td>8.861211</td>
<td>0.000000</td>
<td>50.006563</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>22.026162</td>
<td>0.000000</td>
<td>14.337390</td>
<td>19.885606</td>
<td>18.408424</td>
<td>79.948898</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>100.000000</td>
<td>0.620000</td>
<td>100.000000</td>
<td>100.000000</td>
<td>100.000000</td>
<td>100.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> population_exposed[[<span class="st">'NUTS3_ID'</span>, <span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>, <span class="st">'AREAkm'</span>]].fillna(<span class="dv">0</span>).groupby(<span class="st">'NUTS3_ID'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(np.average(x[[<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>]], weights<span class="op">=</span>x[<span class="st">'AREAkm'</span>], axis<span class="op">=</span><span class="dv">0</span>), index<span class="op">=</span>[<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>])).reset_index()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3_agg.merge(nuts3_temp, left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                            right_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>nuts3_temp <span class="op">=</span> nuts3_temp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>var_list <span class="op">=</span> [<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> var_list:</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[var_list.index(var) <span class="op">//</span> <span class="dv">3</span>, var_list.index(var) <span class="op">%</span> <span class="dv">3</span>]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    nuts3_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span>var, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: var, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3311289089.py:1: DeprecationWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  nuts3_temp = population_exposed[['NUTS3_ID', 'pop%_CFL', 'pop%_EQ', 'pop%_FL', 'pop%_LNDSL', 'pop%_SUBS', 'pop%_WUI', 'AREAkm']].fillna(0).groupby('NUTS3_ID').apply(lambda x: pd.Series(np.average(x[['pop%_CFL', 'pop%_EQ', 'pop%_FL', 'pop%_LNDSL', 'pop%_SUBS', 'pop%_WUI']], weights=x['AREAkm'], axis=0), index=['pop%_CFL', 'pop%_EQ', 'pop%_FL', 'pop%_LNDSL', 'pop%_SUBS', 'pop%_WUI'])).reset_index()</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-22-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>nuts3_temp[[<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>, <span class="st">'NUTS3_TYPE'</span>]].groupby(<span class="st">'NUTS3_TYPE'</span>).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop%_CFL</th>
<th data-quarto-table-cell-role="th">pop%_EQ</th>
<th data-quarto-table-cell-role="th">pop%_FL</th>
<th data-quarto-table-cell-role="th">pop%_LNDSL</th>
<th data-quarto-table-cell-role="th">pop%_SUBS</th>
<th data-quarto-table-cell-role="th">pop%_WUI</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">NUTS3_TYPE</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Intermediate region</td>
<td>0.405872</td>
<td>0.014597</td>
<td>2.302896</td>
<td>6.096409</td>
<td>13.035358</td>
<td>4.270101</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rural region</td>
<td>0.415712</td>
<td>0.006225</td>
<td>2.010725</td>
<td>5.953586</td>
<td>10.745887</td>
<td>2.682079</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Urban region</td>
<td>1.351512</td>
<td>0.008972</td>
<td>4.570900</td>
<td>4.278902</td>
<td>3.917138</td>
<td>5.097406</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap resampling function</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bootstrap_ci(data1, data2, n_bootstrap<span class="op">=</span><span class="dv">1000</span>, ci<span class="op">=</span><span class="dv">95</span>):</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    boot_diffs <span class="op">=</span> []</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    n1, n2 <span class="op">=</span> <span class="bu">len</span>(data1), <span class="bu">len</span>(data2)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_bootstrap):</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        sample1 <span class="op">=</span> np.random.choice(data1, n1, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        sample2 <span class="op">=</span> np.random.choice(data2, n2, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        boot_diffs.append(sample1.mean() <span class="op">-</span> sample2.mean())</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    lower <span class="op">=</span> np.percentile(boot_diffs, (<span class="dv">100</span> <span class="op">-</span> ci) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> np.percentile(boot_diffs, <span class="dv">100</span> <span class="op">-</span> (<span class="dv">100</span> <span class="op">-</span> ci) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lower, upper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-33" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for CF check if the mean urban wetland change is higher for the counties exposed vs the ones not exposed</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>population_exposed <span class="op">=</span> population_exposed.merge(lu_changes, left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)  </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="op">=</span> population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_CFL'</span>])[<span class="st">'urban'</span>].mean() <span class="op">-</span> population_exposed[<span class="st">'urban'</span>].mean()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>conf_interval <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> (population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_CFL'</span>])[<span class="st">'urban'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_CFL'</span>]))))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean difference for CFL: </span><span class="sc">{</span>mean_diff<span class="sc">}</span><span class="ss">, 95% CI: [</span><span class="sc">{</span>mean_diff <span class="op">-</span> conf_interval<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>mean_diff <span class="op">+</span> conf_interval<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="op">=</span> population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_FL'</span>])[<span class="st">'urban'</span>].mean() <span class="op">-</span> population_exposed[<span class="st">'urban'</span>].mean()</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>conf_interval <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> (population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_FL'</span>])[<span class="st">'urban'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_FL'</span>]))))</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean difference for FL: </span><span class="sc">{</span>mean_diff<span class="sc">}</span><span class="ss">, 95% CI: [</span><span class="sc">{</span>mean_diff <span class="op">-</span> conf_interval<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>mean_diff <span class="op">+</span> conf_interval<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="op">=</span> population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_WUI'</span>])[<span class="st">'urban'</span>].mean() <span class="op">-</span> population_exposed[<span class="st">'urban'</span>].mean()</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>conf_interval <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> (population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_WUI'</span>])[<span class="st">'urban'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_WUI'</span>]))))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean difference for WUI: </span><span class="sc">{</span>mean_diff<span class="sc">}</span><span class="ss">, 95% CI: [</span><span class="sc">{</span>mean_diff <span class="op">-</span> conf_interval<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>mean_diff <span class="op">+</span> conf_interval<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="op">=</span> population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_LNDSL'</span>])[<span class="st">'urban'</span>].mean() <span class="op">-</span> population_exposed[<span class="st">'urban'</span>].mean()</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>conf_interval <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> (population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_LNDSL'</span>])[<span class="st">'urban'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_LNDSL'</span>]))))</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean difference for LNDSL: </span><span class="sc">{</span>mean_diff<span class="sc">}</span><span class="ss">, 95% CI: [</span><span class="sc">{</span>mean_diff <span class="op">-</span> conf_interval<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>mean_diff <span class="op">+</span> conf_interval<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="op">=</span> population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_EQ'</span>])[<span class="st">'urban'</span>].mean() <span class="op">-</span> population_exposed[<span class="st">'urban'</span>].mean()</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>conf_interval <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> (population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_EQ'</span>])[<span class="st">'urban'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_EQ'</span>]))))</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean difference for EQ: </span><span class="sc">{</span>mean_diff<span class="sc">}</span><span class="ss">, 95% CI: [</span><span class="sc">{</span>mean_diff <span class="op">-</span> conf_interval<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>mean_diff <span class="op">+</span> conf_interval<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="op">=</span> population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_SUBS'</span>])[<span class="st">'urban'</span>].mean() <span class="op">-</span> population_exposed[<span class="st">'urban'</span>].mean()</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>conf_interval <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> (population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_SUBS'</span>])[<span class="st">'urban'</span>].std() <span class="op">/</span> np.sqrt(<span class="bu">len</span>(population_exposed.dropna(subset<span class="op">=</span>[<span class="st">'pop%_SUBS'</span>]))))</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean difference for SUBS: </span><span class="sc">{</span>mean_diff<span class="sc">}</span><span class="ss">, 95% CI: [</span><span class="sc">{</span>mean_diff <span class="op">-</span> conf_interval<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>mean_diff <span class="op">+</span> conf_interval<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>                        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean difference for CFL: 0.8790953030393553, 95% CI: [0.7444091729129432, 1.0137814331657675]
Mean difference for FL: 0.46378824521397566, 95% CI: [0.4124607861876011, 0.5151157042403501]
Mean difference for WUI: 1.1560496870641936, 95% CI: [1.0088252573831475, 1.3032741167452397]
Mean difference for LNDSL: 0.058408101100205556, 95% CI: [0.02663176955608055, 0.09018443264433057]
Mean difference for EQ: 0.12010555372136777, 95% CI: [0.06790928332386803, 0.17230182411886752]
Mean difference for SUBS: 0.2104839463168986, 95% CI: [0.18535175911720372, 0.23561613351659347]</code></pre>
</div>
</div>
<p>Here we tested the difference of urbanization rate between the exposed counties and the mean rate of urbanization.</p>
<p>We did the same analysis but with the 10% most exposed counties instead of all the exposed counties.</p>
<div id="cell-35" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lists to store results</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>vars_labels <span class="op">=</span> [<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_WUI'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_SUBS'</span>]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>deltas, ci_lowers, ci_uppers <span class="op">=</span> [], [], []</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>deltas_bis, ci_lowers_bis, ci_uppers_bis <span class="op">=</span> [], [], []</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> vars_labels:</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    mean_exposed <span class="op">=</span> population_exposed.loc[population_exposed[var] <span class="op">&gt;</span> <span class="dv">0</span>, <span class="st">'urban'</span>].mean()</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    mean_all <span class="op">=</span> population_exposed[<span class="st">'urban'</span>].mean()</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    data_exposed <span class="op">=</span> population_exposed.loc[population_exposed[var] <span class="op">&gt;</span> <span class="dv">0</span>, <span class="st">'urban'</span>]</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    thr <span class="op">=</span> population_exposed.loc[population_exposed[var] <span class="op">&gt;</span> <span class="dv">0</span>, var].quantile(<span class="fl">0.90</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    data_q90 <span class="op">=</span> population_exposed.loc[population_exposed[var] <span class="op">&gt;</span> thr, <span class="st">'urban'</span>]</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> mean_exposed <span class="op">-</span> mean_all</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    lower, upper <span class="op">=</span> bootstrap_ci(data_exposed, population_exposed[<span class="st">'urban'</span>])</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    deltas.append(delta)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    ci_lowers.append(lower)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    ci_uppers.append(upper)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    delta_bis <span class="op">=</span> data_q90.mean() <span class="op">-</span> mean_all</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    lower_bis, upper_bis <span class="op">=</span> bootstrap_ci(data_q90, population_exposed[<span class="st">'urban'</span>])</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    deltas_bis.append(delta_bis)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    ci_lowers_bis.append(lower_bis)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    ci_uppers_bis.append(upper_bis)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting function</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_deltas_with_ci(labels, deltas, lowers, uppers, title):</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.arange(<span class="bu">len</span>(labels))</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    ci_err <span class="op">=</span> [np.array(deltas) <span class="op">-</span> np.array(lowers), np.array(uppers) <span class="op">-</span> np.array(deltas)]</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    plt.bar(x, deltas, yerr<span class="op">=</span>ci_err, capsize<span class="op">=</span><span class="dv">5</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>    plt.xticks(x, labels, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Mean Urban Change (Delta)'</span>)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for all exposed areas</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>plot_deltas_with_ci(vars_labels, deltas, ci_lowers, ci_uppers,</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Mean Urban Change (All Exposed Areas)'</span>)</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for top 10% exposed areas</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>plot_deltas_with_ci(vars_labels, deltas_bis, ci_lowers_bis, ci_uppers_bis,</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Mean Urban Change (Top 10</span><span class="sc">% E</span><span class="st">xposed Areas)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\281357570.py:9: RuntimeWarning: Mean of empty slice.
  boot_diffs.append(sample1.mean() - sample2.mean())
c:\Users\colin\anaconda3\envs\xarray_env\Lib\site-packages\numpy\core\_methods.py:129: RuntimeWarning: invalid value encountered in scalar divide
  ret = ret.dtype.type(ret / rcount)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-26-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-26-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The graphs show that the exposed counties have a higher rate of urbanization than the mean rate of urbanization in France. But if we look at the 10% most exposed counties, the rate of urbanization is not as significant as for all the exposed counties. It can signify that the most exposed counties are not the most urbanized counties, even if the overall trend is that the exposed counties are more urbanized than the mean rate of urbanization.</p>
<section id="now-compare-correlation-also-with-income-data" class="level4">
<h4 class="anchored" data-anchor-id="now-compare-correlation-also-with-income-data">Now compare correlation also with income data</h4>
<div id="cell-38" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>population_exposed_urban <span class="op">=</span> population_exposed.merge(df_urban, left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># population_exposed_urban[['pop%_CFL', 'pop%_EQ', 'pop%_FL', 'pop%_LNDSL', 'pop%_SUBS', 'pop%_WUI']] = population_exposed_urban[['pop%_CFL', 'pop%_EQ', 'pop%_FL', 'pop%_LNDSL', 'pop%_SUBS', 'pop%_WUI']].fillna(0)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-39" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>var_list <span class="op">=</span> [<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>df_corr_gini <span class="op">=</span> []</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>df_corr_disp <span class="op">=</span> []</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> var_list:</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    df_corr_gini.append(population_exposed_urban[[<span class="st">'Gini'</span>, var]].dropna().corr().iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    df_corr_disp.append(population_exposed_urban[[<span class="st">'Disp_Inc_PPP_2015'</span>, var]].dropna().corr().iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>ax.bar(var_list, df_corr_gini)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Gini Correlation'</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Correlation'</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposure Variable'</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(var_list, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>ax.bar(var_list, df_corr_disp)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Disposable Income Correlation'</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Correlation'</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposure Variable'</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(var_list, rotation<span class="op">=</span><span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\2137756210.py:9: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(var_list, rotation=45)
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\2137756210.py:16: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(var_list, rotation=45)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>[Text(0, 0, 'pop%_CFL'),
 Text(1, 0, 'pop%_EQ'),
 Text(2, 0, 'pop%_FL'),
 Text(3, 0, 'pop%_LNDSL'),
 Text(4, 0, 'pop%_SUBS'),
 Text(5, 0, 'pop%_WUI')]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-29-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>var_list <span class="op">=</span> [<span class="st">'pop%_CFL'</span>, <span class="st">'pop%_EQ'</span>, <span class="st">'pop%_FL'</span>, <span class="st">'pop%_LNDSL'</span>, <span class="st">'pop%_SUBS'</span>, <span class="st">'pop%_WUI'</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df_corr_gini <span class="op">=</span> []</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>df_corr_disp <span class="op">=</span> []</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> var_list:</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    temp_gini <span class="op">=</span> [] </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    temp_disp <span class="op">=</span> []</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">id</span> <span class="kw">in</span> population_exposed_urban[<span class="st">'NUTS3_ID'</span>].unique():</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        temp_gini.append(population_exposed_urban[population_exposed_urban[<span class="st">'NUTS3_ID'</span>]<span class="op">==</span><span class="bu">id</span>][[<span class="st">'Gini'</span>, var]].dropna().corr().iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        temp_disp.append(population_exposed_urban[population_exposed_urban[<span class="st">'NUTS3_ID'</span>]<span class="op">==</span><span class="bu">id</span>][[<span class="st">'Disp_Inc_PPP_2015'</span>, var]].dropna().corr().iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    df_corr_gini.append((temp_gini))</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    df_corr_disp.append((temp_disp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_corr_gini <span class="op">=</span> pd.DataFrame(df_corr_gini, columns<span class="op">=</span>population_exposed_urban[<span class="st">'NUTS3_ID'</span>].unique())</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df_corr_disp <span class="op">=</span> pd.DataFrame(df_corr_disp, columns<span class="op">=</span>population_exposed_urban[<span class="st">'NUTS3_ID'</span>].unique())</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df_corr_gini[<span class="st">'Var'</span>] <span class="op">=</span> var_list</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>df_corr_disp[<span class="st">'Var'</span>] <span class="op">=</span> var_list</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>df_corr_gini <span class="op">=</span> df_corr_gini[[<span class="st">'Var'</span>] <span class="op">+</span> <span class="bu">list</span>(population_exposed_urban[<span class="st">'NUTS3_ID'</span>].unique())]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>df_corr_disp <span class="op">=</span> df_corr_disp[[<span class="st">'Var'</span>] <span class="op">+</span> <span class="bu">list</span>(population_exposed_urban[<span class="st">'NUTS3_ID'</span>].unique())]</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>df_corr_gini <span class="op">=</span> pd.melt(df_corr_gini, id_vars<span class="op">=</span><span class="st">'Var'</span>, var_name<span class="op">=</span><span class="st">'NUTS3_ID'</span>, value_name<span class="op">=</span><span class="st">'Correlation'</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>df_corr_disp <span class="op">=</span> pd.melt(df_corr_disp, id_vars<span class="op">=</span><span class="st">'Var'</span>, var_name<span class="op">=</span><span class="st">'NUTS3_ID'</span>, value_name<span class="op">=</span><span class="st">'Correlation'</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>df_corr_gini[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_corr_gini[<span class="st">'NUTS3_ID'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: nuts3_agg[nuts3_agg.NUTS3_ID<span class="op">==</span>x].NUTS3_TYPE.values[<span class="dv">0</span>])</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>df_corr_disp[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_corr_disp[<span class="st">'NUTS3_ID'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: nuts3_agg[nuts3_agg.NUTS3_ID<span class="op">==</span>x].NUTS3_TYPE.values[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-43" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>ax.bar(var_list, df_corr_gini[[<span class="st">'Var'</span>, <span class="st">'Correlation'</span>]].groupby(<span class="st">'Var'</span>).mean()[<span class="st">'Correlation'</span>])</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Gini Correlation'</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Correlation'</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposure Variable'</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(var_list, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>ax.bar(var_list, df_corr_disp[[<span class="st">'Var'</span>, <span class="st">'Correlation'</span>]].groupby(<span class="st">'Var'</span>).mean()[<span class="st">'Correlation'</span>])</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Disposable Income Correlation'</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Correlation'</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposure Variable'</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(var_list, rotation<span class="op">=</span><span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1644686019.py:9: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(var_list, rotation=45)
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1644686019.py:16: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(var_list, rotation=45)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>[Text(0, 0, 'pop%_CFL'),
 Text(1, 0, 'pop%_EQ'),
 Text(2, 0, 'pop%_FL'),
 Text(3, 0, 'pop%_LNDSL'),
 Text(4, 0, 'pop%_SUBS'),
 Text(5, 0, 'pop%_WUI')]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-32-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df_corr_gini, x<span class="op">=</span><span class="st">'Var'</span>, y<span class="op">=</span><span class="st">'Correlation'</span>, ax<span class="op">=</span>ax, hue<span class="op">=</span><span class="st">'NUTS3_TYPE'</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Gini Correlation'</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Correlation'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposure Variable'</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(var_list, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df_corr_disp, x<span class="op">=</span><span class="st">'Var'</span>, y<span class="op">=</span><span class="st">'Correlation'</span>, ax<span class="op">=</span>ax, hue<span class="op">=</span><span class="st">'NUTS3_TYPE'</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Disposable Income Correlation'</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Correlation'</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposure Variable'</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(var_list, rotation<span class="op">=</span><span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3648303877.py:10: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(var_list, rotation=45)
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3648303877.py:17: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(var_list, rotation=45)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>[Text(0, 0, 'pop%_CFL'),
 Text(1, 0, 'pop%_EQ'),
 Text(2, 0, 'pop%_FL'),
 Text(3, 0, 'pop%_LNDSL'),
 Text(4, 0, 'pop%_SUBS'),
 Text(5, 0, 'pop%_WUI')]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-33-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="now-with-climate-data" class="level3">
<h3 class="anchored" data-anchor-id="now-with-climate-data">Now with climate data</h3>
<div id="cell-46" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>clim_df <span class="op">=</span> pd.read_csv(<span class="st">'../../data/indicesQ50_25021114242922763.txt'</span>, sep<span class="op">=</span><span class="st">';'</span>, comment<span class="op">=</span><span class="st">'#'</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>clim_df.columns <span class="op">=</span> [<span class="st">'index'</span>, <span class="st">'lat'</span>, <span class="st">'lon'</span>, <span class="st">'scenario'</span>, <span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'nan'</span>]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>clim_df <span class="op">=</span> clim_df.drop(<span class="st">'nan'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#map the data_new to each county in the shapefile based on the closest lat lon</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial <span class="im">import</span> distance</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> closest_node(node, nodes):</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    closest_index <span class="op">=</span> distance.cdist([node], nodes).argmin()</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> closest_index</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>clim_shp <span class="op">=</span> nuts3.copy()</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>clim_shp <span class="op">=</span> clim_shp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'lat'</span>] <span class="op">=</span> clim_shp.geometry.centroid.y</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'lon'</span>] <span class="op">=</span> clim_shp.geometry.centroid.x</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'index'</span>] <span class="op">=</span> clim_shp.<span class="bu">apply</span>(<span class="kw">lambda</span> x: closest_node([x[<span class="st">'lat'</span>], x[<span class="st">'lon'</span>]], clim_df[[<span class="st">'lat'</span>, <span class="st">'lon'</span>]].values), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1413295237.py:9: UserWarning: Geometry is in a geographic CRS. Results from 'centroid' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

  clim_shp['lat'] = clim_shp.geometry.centroid.y
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1413295237.py:10: UserWarning: Geometry is in a geographic CRS. Results from 'centroid' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

  clim_shp['lon'] = clim_shp.geometry.centroid.x</code></pre>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'pr_cum'</span>] <span class="op">=</span> clim_shp[<span class="st">'index'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: clim_df.loc[x, <span class="st">'pr_cum'</span>])</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'tasmax'</span>] <span class="op">=</span> clim_shp[<span class="st">'index'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: clim_df.loc[x, <span class="st">'tasmax'</span>])</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'wf_risk'</span>] <span class="op">=</span> clim_shp[<span class="st">'index'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: clim_df.loc[x, <span class="st">'wf_risk'</span>])</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'droughts_day'</span>] <span class="op">=</span> clim_shp[<span class="st">'index'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: clim_df.loc[x, <span class="st">'droughts_day'</span>])</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'day30'</span>] <span class="op">=</span> clim_shp[<span class="st">'index'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: clim_df.loc[x, <span class="st">'day30'</span>])</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'decile_pr_cum'</span>] <span class="op">=</span> pd.qcut(clim_shp[<span class="st">'pr_cum'</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'decile_tasmax'</span>] <span class="op">=</span> pd.qcut(clim_shp[<span class="st">'tasmax'</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'decile_wf_risk'</span>] <span class="op">=</span> pd.qcut(clim_shp[<span class="st">'wf_risk'</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>, duplicates<span class="op">=</span><span class="st">'drop'</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'decile_droughts_day'</span>] <span class="op">=</span> pd.qcut(clim_shp[<span class="st">'droughts_day'</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>clim_shp[<span class="st">'decile_day30'</span>] <span class="op">=</span> pd.qcut(clim_shp[<span class="st">'day30'</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-49" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>clim_shp[[<span class="st">'tasmax'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'day30'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tasmax</th>
<th data-quarto-table-cell-role="th">pr_cum</th>
<th data-quarto-table-cell-role="th">wf_risk</th>
<th data-quarto-table-cell-role="th">droughts_day</th>
<th data-quarto-table-cell-role="th">day30</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>36573.000000</td>
<td>36573.000000</td>
<td>36573.000000</td>
<td>36573.000000</td>
<td>36573.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>22.717501</td>
<td>41.716254</td>
<td>2.017417</td>
<td>88.524267</td>
<td>7.972171</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.046568</td>
<td>14.294383</td>
<td>4.586476</td>
<td>36.785674</td>
<td>6.309333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>7.510000</td>
<td>26.640000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>21.520000</td>
<td>33.050000</td>
<td>0.000000</td>
<td>63.000000</td>
<td>3.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>22.780000</td>
<td>36.870000</td>
<td>1.000000</td>
<td>92.000000</td>
<td>6.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>23.900000</td>
<td>44.270000</td>
<td>2.000000</td>
<td>115.000000</td>
<td>10.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>29.490000</td>
<td>178.530000</td>
<td>60.000000</td>
<td>239.000000</td>
<td>49.600000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-50" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>clim_agg <span class="op">=</span> clim_shp.groupby(<span class="st">'NUTS3_ID'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: pd.Series(np.average(x[[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>]], weights<span class="op">=</span>x[<span class="st">'AREAkm'</span>], axis<span class="op">=</span><span class="dv">0</span>), index<span class="op">=</span>[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>])).reset_index()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>clim_agg <span class="op">=</span> nuts3_agg.merge(clim_agg, left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, right_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">5</span>,figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>var_list <span class="op">=</span> [<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> var_list:</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[var_list.index(var)]</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    clim_agg.plot(ax<span class="op">=</span>ax, column<span class="op">=</span>var, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: var, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    ax.set_title(var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\559969990.py:1: DeprecationWarning: DataFrameGroupBy.apply operated on the grouping columns. This behavior is deprecated, and in a future version of pandas the grouping columns will be excluded from the operation. Either pass `include_groups=False` to exclude the groupings or explicitly select the grouping columns after groupby to silence this warning.
  clim_agg = clim_shp.groupby('NUTS3_ID').apply(lambda x: pd.Series(np.average(x[['tasmax', 'day30', 'pr_cum', 'wf_risk', 'droughts_day']], weights=x['AREAkm'], axis=0), index=['tasmax', 'day30', 'pr_cum', 'wf_risk', 'droughts_day'])).reset_index()</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-38-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-51" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>clim_df <span class="op">=</span> clim_shp[[<span class="st">'LAU_ID'</span>, <span class="st">'AREAkm'</span>, <span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>]]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>clim_df <span class="op">=</span> clim_df.merge(df_urban.drop(columns<span class="op">=</span><span class="st">'AREAkm'</span>), left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>clim_df_corr <span class="op">=</span> clim_df[[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].corr()</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># nan_corr = ['urban', 'cropland', 'forest', 'wetland']</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for var in nan_corr:</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     for var2 in nan_corr:</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         clim_df_corr.loc[var, var2] = np.nan</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># nan_corr = ['tasmax', 'day30', 'pr_cum', 'wf_risk', 'droughts_day']</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for var in nan_corr:</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     for var2 in nan_corr:</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">#         clim_df_corr.loc[var, var2] = np.nan</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># clim_df_corr[clim_df_corr==1] = np.nan      </span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>clim_df_corr<span class="op">=</span>clim_df_corr.sort_index()</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>clim_df_corr <span class="op">=</span> clim_df_corr.sort_index(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>sns.heatmap(<span class="bu">round</span>(clim_df_corr,<span class="dv">2</span>), annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, ax<span class="op">=</span>ax, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Correlation Matrix Between Climate and Socioeconomic Variables'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>Text(0.5, 1.0, 'Correlation Matrix Between Climate and Socioeconomic Variables')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-39-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> clim_df.dropna(subset<span class="op">=</span>[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>])</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr[[<span class="st">'NUTS3_ID'</span>, <span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].groupby(<span class="st">'NUTS3_ID'</span>).corr().reset_index()</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr.drop(columns<span class="op">=</span><span class="st">'NUTS3_ID'</span>).groupby(<span class="st">'level_1'</span>).mean()</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr.sort_index( )</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr.sort_index(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># nan_corr = ['urban', 'cropland', 'forest', 'wetland']</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for var in nan_corr:</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     for var2 in nan_corr:</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">#         df_corr.loc[var, var2] = np.nan</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># nan_corr = ['tasmax', 'day30', 'pr_cum', 'wf_risk', 'droughts_day']</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># for var in nan_corr:</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     for var2 in nan_corr:</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         df_corr.loc[var, var2] = np.nan</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co"># df_corr[df_corr==1] = np.nan      </span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Correlation Matrix Between Climate and Socioeconomic Variables'</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>sns.heatmap(<span class="bu">round</span>(df_corr,<span class="dv">2</span>), annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, ax<span class="op">=</span>ax, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> clim_df.dropna(subset<span class="op">=</span>[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>])</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr[[<span class="st">'NUTS3_ID'</span>, <span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].groupby(<span class="st">'NUTS3_ID'</span>).corr().reset_index()</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>df_corr[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_corr[<span class="st">'NUTS3_ID'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: nuts3_agg[nuts3_agg.NUTS3_ID<span class="op">==</span>x].NUTS3_TYPE.values[<span class="dv">0</span>])</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df_corr = df_corr[df_corr.level_1=='tasmax']</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_corr[['Gini', 'Disp_Inc_PPP_2015', 'urban', 'cropland', 'forest', 'wetland', 'NUTS3_TYPE']].groupby('NUTS3_TYPE').mean())</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>var_list <span class="op">=</span> [<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>]</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr[df_corr.level_1.isin([<span class="st">'urban'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>])]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># axs[i//3, i%3].axis('off')</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axs[i<span class="op">//</span><span class="dv">3</span>, i<span class="op">%</span><span class="dv">3</span>]</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(x<span class="op">=</span><span class="st">'level_1'</span>, y<span class="op">=</span>var_list[i], data<span class="op">=</span>df_corr, hue<span class="op">=</span><span class="st">'NUTS3_TYPE'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    ax.set_title(var_list[i])</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Correlation'</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Variable'</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels([<span class="st">'Urban Change'</span>, <span class="st">'Gini'</span>, <span class="st">'Disposable Income'</span>], rotation<span class="op">=</span><span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3419486539.py:16: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(['Urban Change', 'Gini', 'Disposable Income'], rotation=45)
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3419486539.py:16: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(['Urban Change', 'Gini', 'Disposable Income'], rotation=45)
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3419486539.py:16: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(['Urban Change', 'Gini', 'Disposable Income'], rotation=45)
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3419486539.py:16: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(['Urban Change', 'Gini', 'Disposable Income'], rotation=45)
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3419486539.py:16: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(['Urban Change', 'Gini', 'Disposable Income'], rotation=45)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-41-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>df_corr[df_corr[<span class="st">'level_1'</span>]<span class="op">==</span><span class="st">'tasmax'</span>][[<span class="st">'NUTS3_ID'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NUTS3_ID</th>
<th data-quarto-table-cell-role="th">Gini</th>
<th data-quarto-table-cell-role="th">Disp_Inc_PPP_2015</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot nuts agg map with correlation between tasmax and Gini</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> clim_df.dropna(subset<span class="op">=</span>[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>])</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>df_corr <span class="op">=</span> df_corr[[<span class="st">'NUTS3_ID'</span>, <span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]].groupby(<span class="st">'NUTS3_ID'</span>).corr().reset_index()</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>df_corr[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_corr[<span class="st">'NUTS3_ID'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: nuts3_agg[nuts3_agg.NUTS3_ID<span class="op">==</span>x].NUTS3_TYPE.values[<span class="dv">0</span>])</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>nuts_temp <span class="op">=</span> nuts3_agg.merge(df_corr[df_corr[<span class="st">'level_1'</span>]<span class="op">==</span><span class="st">'tasmax'</span>][[<span class="st">'NUTS3_ID'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>]], left_on<span class="op">=</span><span class="st">'NUTS3_ID'</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                            right_on <span class="op">=</span> <span class="st">'NUTS3_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>fig,axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), subplot_kw<span class="op">=</span>{<span class="st">'projection'</span>: ccrs.PlateCarree()})</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>nuts_temp <span class="op">=</span> nuts_temp.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>nuts3_agg <span class="op">=</span> nuts3_agg.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">0</span>]</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>nuts_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'Gini'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Correlation Between Gini and Tasmax"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Correlation Between Gini and Tasmax'</span>)</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axs[<span class="dv">1</span>]</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>nuts3_agg.boundary.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>nuts_temp.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">'Disp_Inc_PPP_2015'</span>, legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Correlation Between Disposable Income and Tasmax"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>})</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>ax.set_extent([<span class="op">-</span><span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">41</span>, <span class="dv">52</span>])</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Correlation Between Disposable Income and Tasmax'</span>)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>                            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>Text(0.5, 1.0, 'Correlation Between Disposable Income and Tasmax')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-43-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>df_panel <span class="op">=</span> clim_df.dropna(subset<span class="op">=</span>[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'urban'</span>])</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>df_panel[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_panel[<span class="st">'NUTS3_ID'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: nuts3_agg[nuts3_agg.NUTS3_ID<span class="op">==</span>x].NUTS3_TYPE.values[<span class="dv">0</span>])</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>df_panel[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_panel[<span class="st">'NUTS3_TYPE'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set region as categorical variable (Fixed Effects via Dummy Variables)</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>df_panel[<span class="st">'NUTS3_ID'</span>] <span class="op">=</span> df_panel[<span class="st">'NUTS3_ID'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: First-stage regression (suspected endogenous variable on the instrument)</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>first_stage <span class="op">=</span> smf.ols(<span class="st">"Disp_Inc_PPP_2015 ~ tasmax + day30 + pr_cum + wf_risk + droughts_day + Gini"</span>, data<span class="op">=</span>df_panel).fit()</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the residuals (differences between observed and predicted values)</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>df_panel[<span class="st">"residuals"</span>] <span class="op">=</span> first_stage.resid</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Second-stage regression (main equation including the residuals)</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>second_stage <span class="op">=</span> smf.ols(<span class="st">"urban ~ tasmax + day30 + pr_cum + wf_risk + droughts_day + Gini + Disp_Inc_PPP_2015 + residuals"</span>, data<span class="op">=</span>df_panel).fit()</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Check the p-value of the residuals</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>p_value <span class="op">=</span> second_stage.pvalues[<span class="st">"residuals"</span>]</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(second_stage.summary())</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Interpretation</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> p_value <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"⚠️ Endogeneity detected! Use Instrumental Variables (IV) regression instead of OLS."</span>)</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✅ No endogeneity detected. OLS estimates are consistent."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  urban   R-squared:                       0.060
Model:                            OLS   Adj. R-squared:                  0.060
Method:                 Least Squares   F-statistic:                     290.5
Date:                Tue, 18 Mar 2025   Prob (F-statistic):               0.00
Time:                        14:58:09   Log-Likelihood:                -65215.
No. Observations:               32012   AIC:                         1.304e+05
Df Residuals:                   32004   BIC:                         1.305e+05
Df Model:                           7                                         
Covariance Type:            nonrobust                                         
=====================================================================================
                        coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------
Intercept            -1.2529      0.331     -3.783      0.000      -1.902      -0.604
tasmax                0.1324      0.014      9.564      0.000       0.105       0.160
day30                -0.0123      0.005     -2.583      0.010      -0.022      -0.003
pr_cum               -0.0041      0.001     -3.794      0.000      -0.006      -0.002
wf_risk               0.0331      0.004      9.051      0.000       0.026       0.040
droughts_day         -0.0007      0.000     -1.646      0.100      -0.002       0.000
Gini                  0.5457      0.145      3.773      0.000       0.262       0.829
Disp_Inc_PPP_2015 -3.004e-05   1.82e-05     -1.649      0.099   -6.57e-05    5.67e-06
residuals             0.0003   1.92e-05     13.013      0.000       0.000       0.000
==============================================================================
Omnibus:                    18273.885   Durbin-Watson:                   1.312
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           270917.419
Skew:                           2.452   Prob(JB):                         0.00
Kurtosis:                      16.382   Cond. No.                     2.01e+20
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 2.13e-28. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
⚠️ Endogeneity detected! Use Instrumental Variables (IV) regression instead of OLS.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1517706686.py:7: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_panel['NUTS3_TYPE'] = df_panel['NUTS3_ID'].apply(lambda x: nuts3_agg[nuts3_agg.NUTS3_ID==x].NUTS3_TYPE.values[0])
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1517706686.py:8: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_panel['NUTS3_TYPE'] = df_panel['NUTS3_TYPE'].astype('category')
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1517706686.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_panel['NUTS3_ID'] = df_panel['NUTS3_ID'].astype('category')
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\1517706686.py:16: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_panel["residuals"] = first_stage.resid</code></pre>
</div>
</div>
<div id="cell-57" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select numerical predictors</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_panel[[<span class="st">'tasmax'</span>, <span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>]]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant for VIF calculation</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute VIF for each variable</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>vif_data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>vif_data[<span class="st">"Variable"</span>] <span class="op">=</span> X.columns</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>vif_data[<span class="st">"VIF"</span>] <span class="op">=</span> [variance_inflation_factor(X.values, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>])]</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print VIF scores</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vif_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Variable         VIF
0              const  693.063850
1             tasmax    5.754275
2              day30    7.124314
3             pr_cum    1.756096
4            wf_risk    2.505874
5       droughts_day    1.743745
6               Gini    1.125342
7  Disp_Inc_PPP_2015    1.125298</code></pre>
</div>
</div>
<div id="cell-58" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the data</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>df_panel[[<span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>]] <span class="op">=</span> scaler.fit_transform(df_panel[[<span class="st">'day30'</span>, <span class="st">'pr_cum'</span>, <span class="st">'wf_risk'</span>, <span class="st">'droughts_day'</span>, <span class="st">'Gini'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>]])</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Run Fixed Effects Model (Region-Level)</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> smf.ols(<span class="st">"urban ~  day30 + pr_cum + wf_risk + droughts_day + Gini + Disp_Inc_PPP_2015 + C(NUTS3_TYPE)"</span>, data<span class="op">=</span>df_panel).fit()</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  urban   R-squared:                       0.078
Model:                            OLS   Adj. R-squared:                  0.077
Method:                 Least Squares   F-statistic:                     336.3
Date:                Tue, 18 Mar 2025   Prob (F-statistic):               0.00
Time:                        14:58:09   Log-Likelihood:                -64909.
No. Observations:               32012   AIC:                         1.298e+05
Df Residuals:                   32003   BIC:                         1.299e+05
Df Model:                           8                                         
Covariance Type:            nonrobust                                         
=================================================================================================
                                    coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------------
Intercept                         1.2464      0.018     69.746      0.000       1.211       1.281
C(NUTS3_TYPE)[T.Rural region]    -0.2898      0.024    -12.271      0.000      -0.336      -0.243
C(NUTS3_TYPE)[T.Urban region]     0.6552      0.038     17.131      0.000       0.580       0.730
day30                             0.1899      0.014     13.414      0.000       0.162       0.218
pr_cum                            0.0747      0.014      5.475      0.000       0.048       0.101
wf_risk                           0.0368      0.016      2.274      0.023       0.005       0.068
droughts_day                      0.0638      0.013      4.793      0.000       0.038       0.090
Gini                             -0.1303      0.011    -11.884      0.000      -0.152      -0.109
Disp_Inc_PPP_2015                 0.3160      0.011     27.824      0.000       0.294       0.338
==============================================================================
Omnibus:                    17840.536   Durbin-Watson:                   1.336
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           261386.762
Skew:                           2.376   Prob(JB):                         0.00
Kurtosis:                      16.167   Cond. No.                         5.74
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3515244537.py:7: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_panel[['day30', 'pr_cum', 'wf_risk', 'droughts_day', 'Gini', 'Disp_Inc_PPP_2015']] = scaler.fit_transform(df_panel[['day30', 'pr_cum', 'wf_risk', 'droughts_day', 'Gini', 'Disp_Inc_PPP_2015']])</code></pre>
</div>
</div>
</section>
<section id="pprn---plan-de-prévention-des-risques-naturels" class="level3">
<h3 class="anchored" data-anchor-id="pprn---plan-de-prévention-des-risques-naturels">PPRN - Plan de Prévention des Risques Naturels</h3>
<div id="cell-60" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df_catnat <span class="op">=</span> pd.read_csv(<span class="st">'../../data/gaspar/catnat_gaspar.csv'</span>, sep<span class="op">=</span><span class="st">';'</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'start_year'</span>] <span class="op">=</span> pd.to_datetime(df_catnat[<span class="st">'dat_deb'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>).dt.year</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'before_2005'</span>] <span class="op">=</span> (df_catnat[<span class="st">'start_year'</span>] <span class="op">&lt;=</span> <span class="dv">2005</span>).astype(<span class="bu">int</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'after_2005'</span>] <span class="op">=</span> (df_catnat[<span class="st">'start_year'</span>] <span class="op">&gt;</span> <span class="dv">2005</span>).astype(<span class="bu">int</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>df_catnat <span class="op">=</span> df_catnat[[<span class="st">'cod_commune'</span>, <span class="st">'before_2005'</span>, <span class="st">'after_2005'</span>]].groupby(<span class="st">'cod_commune'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>df_catnat <span class="op">=</span> disp_inc_2015.merge(df_catnat, right_on<span class="op">=</span><span class="st">'cod_commune'</span>, left_on<span class="op">=</span><span class="st">'AU_code'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'Population'</span>] <span class="op">=</span> df_catnat[<span class="st">'Population'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>df_catnat <span class="op">=</span> df_catnat.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'geometry'</span>] <span class="op">=</span> df_catnat[<span class="st">'geometry'</span>].centroid</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>df_catnat <span class="op">=</span> gpd.sjoin(nuts3, df_catnat, how<span class="op">=</span><span class="st">'left'</span>, op<span class="op">=</span><span class="st">'contains'</span>).drop_duplicates(subset<span class="op">=</span><span class="st">'COMM_ID'</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>df_catnat <span class="op">=</span> pd.merge(df_catnat[[<span class="st">'cod_commune'</span>, <span class="st">'before_2005'</span>, <span class="st">'after_2005'</span>, <span class="st">'LAU_ID'</span>, <span class="st">'Disp_Inc_PPP_2015'</span>, <span class="st">'Population'</span>, <span class="st">'Gini'</span>]], lu_changes, left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>df_catnat <span class="op">=</span> df_catnat.dropna()</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'exposed'</span>] <span class="op">=</span> (df_catnat[<span class="st">'before_2005'</span>] <span class="op">&gt;</span> <span class="dv">2</span>) <span class="op">&amp;</span> (df_catnat[<span class="st">'before_2005'</span>] <span class="op">&lt;=</span><span class="dv">10</span>).astype(<span class="bu">int</span>)</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'not_exposed'</span>] <span class="op">=</span> (df_catnat[<span class="st">'before_2005'</span>] <span class="op">&lt;</span> <span class="dv">3</span>).astype(<span class="bu">int</span>)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>df_catnat[<span class="st">'very_exposed'</span>] <span class="op">=</span> (df_catnat[<span class="st">'before_2005'</span>] <span class="op">&gt;</span> <span class="dv">10</span>).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\3170999649.py:12: UserWarning: Geometry is in a geographic CRS. Results from 'centroid' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

  df_catnat['geometry'] = df_catnat['geometry'].centroid
c:\Users\colin\anaconda3\envs\xarray_env\Lib\site-packages\IPython\core\interactiveshell.py:3517: FutureWarning: The `op` parameter is deprecated and will be removed in a future release. Please use the `predicate` parameter instead.
  if await self.run_code(code, result, async_=asy):</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_catnat[[<span class="st">'exposed'</span>, <span class="st">'not_exposed'</span>, <span class="st">'very_exposed'</span>]].<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>exposed         22725
not_exposed      5108
very_exposed     2319
dtype: int64</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make an ols model</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>df_catnat[[<span class="st">'Population'</span>, <span class="st">'Gini'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]] <span class="op">=</span> scaler.fit_transform(df_catnat[[<span class="st">'Population'</span>, <span class="st">'Gini'</span>, <span class="st">'urban'</span>, <span class="st">'cropland'</span>, <span class="st">'forest'</span>, <span class="st">'wetland'</span>]])</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> smf.ols(<span class="st">"urban ~  not_exposed + very_exposed + Population + Gini"</span>, data<span class="op">=</span>df_catnat).fit()</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  urban   R-squared:                       0.033
Model:                            OLS   Adj. R-squared:                  0.033
Method:                 Least Squares   F-statistic:                     258.9
Date:                Tue, 18 Mar 2025   Prob (F-statistic):          3.76e-219
Time:                        15:00:38   Log-Likelihood:                -42275.
No. Observations:               30152   AIC:                         8.456e+04
Df Residuals:                   30147   BIC:                         8.460e+04
Df Model:                           4                                         
Covariance Type:            nonrobust                                         
================================================================================
                   coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------
Intercept       -0.0085      0.007     -1.295      0.195      -0.021       0.004
not_exposed     -0.2049      0.015    -13.431      0.000      -0.235      -0.175
very_exposed     0.5612      0.021     26.129      0.000       0.519       0.603
Population       0.0322      0.006      5.674      0.000       0.021       0.043
Gini             0.0163      0.006      2.873      0.004       0.005       0.027
==============================================================================
Omnibus:                    17338.709   Durbin-Watson:                   1.328
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           249146.462
Skew:                           2.488   Prob(JB):                         0.00
Kurtosis:                      16.174   Cond. No.                         3.93
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<div id="cell-63" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df_catnat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">cod_commune</th>
<th data-quarto-table-cell-role="th">before_2005</th>
<th data-quarto-table-cell-role="th">after_2005</th>
<th data-quarto-table-cell-role="th">LAU_ID</th>
<th data-quarto-table-cell-role="th">Disp_Inc_PPP_2015</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">Gini</th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">urban</th>
<th data-quarto-table-cell-role="th">cropland</th>
<th data-quarto-table-cell-role="th">forest</th>
<th data-quarto-table-cell-role="th">wetland</th>
<th data-quarto-table-cell-role="th">NUTS3_ID</th>
<th data-quarto-table-cell-role="th">LAU_name</th>
<th data-quarto-table-cell-role="th">CNTRY</th>
<th data-quarto-table-cell-role="th">COMM_ID</th>
<th data-quarto-table-cell-role="th">AREAkm</th>
<th data-quarto-table-cell-role="th">exposed</th>
<th data-quarto-table-cell-role="th">not_exposed</th>
<th data-quarto-table-cell-role="th">very_exposed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>75056</td>
<td>16.0</td>
<td>6.0</td>
<td>FR1175115101</td>
<td>20984.416222</td>
<td>2096399.0</td>
<td>0.4258735527</td>
<td>0</td>
<td>-0.000223</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>FR101</td>
<td>Paris 1er Arrondissement</td>
<td>FR</td>
<td>FR1175115101</td>
<td>1.940344</td>
<td>False</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>77013</td>
<td>5.0</td>
<td>5.0</td>
<td>FR1177107013</td>
<td>19868.828178</td>
<td>347.0</td>
<td>0.2629437346</td>
<td>0</td>
<td>0.158149</td>
<td>-0.117307</td>
<td>-0.040842</td>
<td>0.0</td>
<td>FR102</td>
<td>Aulnoy</td>
<td>FR</td>
<td>FR1177107013</td>
<td>14.121237</td>
<td>True</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>77042</td>
<td>15.0</td>
<td>6.0</td>
<td>FR1177107042</td>
<td>18986.781512</td>
<td>3272.0</td>
<td>0.2215423907</td>
<td>0</td>
<td>0.434580</td>
<td>-0.433159</td>
<td>-0.001421</td>
<td>0.0</td>
<td>FR102</td>
<td>Boissy-le-Chatel</td>
<td>FR</td>
<td>FR1177107042</td>
<td>10.410217</td>
<td>False</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>77063</td>
<td>8.0</td>
<td>3.0</td>
<td>FR1177107063</td>
<td>19883.496657</td>
<td>1326.5</td>
<td>0.2629437346</td>
<td>0</td>
<td>1.989344</td>
<td>-1.368625</td>
<td>-0.620719</td>
<td>0.0</td>
<td>FR102</td>
<td>La Celle-sur-Morin</td>
<td>FR</td>
<td>FR1177107063</td>
<td>7.323961</td>
<td>True</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>77070</td>
<td>7.0</td>
<td>3.0</td>
<td>FR1177107070</td>
<td>18979.011342</td>
<td>1352.5</td>
<td>0.2629437346</td>
<td>0</td>
<td>0.935572</td>
<td>-0.931869</td>
<td>-0.003703</td>
<td>0.0</td>
<td>FR102</td>
<td>Chailly-en-Brie</td>
<td>FR</td>
<td>FR1177107070</td>
<td>17.987626</td>
<td>True</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36567</td>
<td>2B185</td>
<td>3.0</td>
<td>7.0</td>
<td>FR942B529185</td>
<td>14301.194431</td>
<td>1247.5</td>
<td>0.3023729726</td>
<td>0</td>
<td>1.731351</td>
<td>-0.856246</td>
<td>-0.803746</td>
<td>0.0</td>
<td>FR832</td>
<td>Oletta</td>
<td>FR</td>
<td>FR942B529185</td>
<td>26.209307</td>
<td>True</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36568</td>
<td>2B188</td>
<td>3.0</td>
<td>7.0</td>
<td>FR942B529188</td>
<td>14616.310408</td>
<td>405.0</td>
<td>0.3023729726</td>
<td>0</td>
<td>1.194328</td>
<td>-0.599132</td>
<td>-0.507404</td>
<td>0.0</td>
<td>FR832</td>
<td>Olmeta-di-Tuda</td>
<td>FR</td>
<td>FR942B529188</td>
<td>17.349720</td>
<td>True</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36569</td>
<td>2B205</td>
<td>6.0</td>
<td>1.0</td>
<td>FR942B529205</td>
<td>14506.713495</td>
<td>719.0</td>
<td>0.3023729726</td>
<td>0</td>
<td>2.204422</td>
<td>-1.123884</td>
<td>-1.075430</td>
<td>0.0</td>
<td>FR832</td>
<td>Patrimonio</td>
<td>FR</td>
<td>FR942B529205</td>
<td>17.910190</td>
<td>True</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36570</td>
<td>2B239</td>
<td>4.0</td>
<td>7.0</td>
<td>FR942B529239</td>
<td>16193.325254</td>
<td>180.5</td>
<td>0.3023729726</td>
<td>0</td>
<td>1.171958</td>
<td>-0.587080</td>
<td>-0.584878</td>
<td>0.0</td>
<td>FR832</td>
<td>Poggio-d'Oletta</td>
<td>FR</td>
<td>FR942B529239</td>
<td>15.941996</td>
<td>True</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36572</td>
<td>2B333</td>
<td>1.0</td>
<td>9.0</td>
<td>FR942B529333</td>
<td>14493.114111</td>
<td>118.0</td>
<td>0.3023729726</td>
<td>0</td>
<td>0.117317</td>
<td>0.731918</td>
<td>-0.839897</td>
<td>0.0</td>
<td>FR832</td>
<td>Vallecalle</td>
<td>FR</td>
<td>FR942B529333</td>
<td>6.754775</td>
<td>False</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>30152 rows × 20 columns</p>
</div>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df_pprn <span class="op">=</span> pd.read_csv(<span class="st">'../../data/gaspar/pprn_gaspar.csv'</span>, sep<span class="op">=</span><span class="st">';'</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'start_year'</span>] <span class="op">=</span> pd.to_datetime(df_pprn[<span class="st">'dat_prescription'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>).dt.year</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'pprn_before_2005'</span>] <span class="op">=</span> (df_pprn[<span class="st">'start_year'</span>] <span class="op">&lt;=</span> <span class="dv">2005</span>).astype(<span class="bu">int</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'pprn_after_2005'</span>] <span class="op">=</span> (df_pprn[<span class="st">'start_year'</span>] <span class="op">&gt;</span> <span class="dv">2005</span>).astype(<span class="bu">int</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>df_pprn <span class="op">=</span> df_pprn[[<span class="st">'cod_commune'</span>, <span class="st">'pprn_before_2005'</span>, <span class="st">'pprn_after_2005'</span>]].groupby(<span class="st">'cod_commune'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>df_pprn <span class="op">=</span> df_catnat.merge(df_pprn, right_on<span class="op">=</span><span class="st">'cod_commune'</span>, left_on<span class="op">=</span><span class="st">'cod_commune'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'pprn_before_2005'</span>] <span class="op">=</span> df_pprn[<span class="st">'pprn_before_2005'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'pprn_after_2005'</span>] <span class="op">=</span> df_pprn[<span class="st">'pprn_after_2005'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'well_adapted'</span>] <span class="op">=</span> (df_pprn[<span class="st">'pprn_before_2005'</span>] <span class="op">&gt;</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'not_adapted'</span>] <span class="op">=</span> (df_pprn[<span class="st">'pprn_before_2005'</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'diff'</span>] <span class="op">=</span> df_pprn[<span class="st">'after_2005'</span>] <span class="op">-</span> df_pprn[<span class="st">'before_2005'</span>]</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>df_pprn[<span class="st">'NUTS3_TYPE'</span>] <span class="op">=</span> df_pprn[<span class="st">'NUTS3_ID'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: nuts3_agg[nuts3_agg.NUTS3_ID<span class="op">==</span>x].NUTS3_TYPE.values[<span class="dv">0</span>]).astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\colin\AppData\Local\Temp\ipykernel_51568\310552785.py:1: DtypeWarning: Columns (6) have mixed types. Specify dtype option on import or set low_memory=False.
  df_pprn = pd.read_csv('../../data/gaspar/pprn_gaspar.csv', sep=';')</code></pre>
</div>
</div>
<div id="cell-65" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df_pprn.NUTS3_TYPE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>0               Urban region
1        Intermediate region
2        Intermediate region
3        Intermediate region
4        Intermediate region
                ...         
30147           Rural region
30148           Rural region
30149           Rural region
30150           Rural region
30151           Rural region
Name: NUTS3_TYPE, Length: 30152, dtype: category
Categories (3, object): ['Intermediate region', 'Rural region', 'Urban region']</code></pre>
</div>
</div>
<div id="cell-66" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>df_pprn[[<span class="st">'Population'</span>, <span class="st">'Gini'</span>]] <span class="op">=</span> scaler.fit_transform(df_pprn[[<span class="st">'Population'</span>, <span class="st">'Gini'</span>]])</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> smf.ols(<span class="st">"urban ~  well_adapted + not_exposed + very_exposed + Population + Gini + not_adapted + diff +C(NUTS3_TYPE)"</span>, data<span class="op">=</span>df_pprn).fit()</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  urban   R-squared:                       0.063
Model:                            OLS   Adj. R-squared:                  0.063
Method:                 Least Squares   F-statistic:                     255.1
Date:                Tue, 18 Mar 2025   Prob (F-statistic):               0.00
Time:                        15:10:15   Log-Likelihood:                -60316.
No. Observations:               30152   AIC:                         1.206e+05
Df Residuals:                   30143   BIC:                         1.207e+05
Df Model:                           8                                         
Covariance Type:            nonrobust                                         
=================================================================================================
                                    coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------------
Intercept                         0.9820      0.018     53.917      0.000       0.946       1.018
C(NUTS3_TYPE)[T.Rural region]    -0.4035      0.023    -17.849      0.000      -0.448      -0.359
C(NUTS3_TYPE)[T.Urban region]     0.5985      0.040     15.024      0.000       0.520       0.677
well_adapted                      0.6169      0.024     25.722      0.000       0.570       0.664
not_exposed                      -0.4178      0.030    -14.149      0.000      -0.476      -0.360
very_exposed                      1.0643      0.046     23.086      0.000       0.974       1.155
Population                        0.0527      0.010      5.097      0.000       0.032       0.073
Gini                             -0.0341      0.011     -3.228      0.001      -0.055      -0.013
not_adapted                       0.3651      0.014     25.464      0.000       0.337       0.393
diff                              0.0332      0.004      8.635      0.000       0.026       0.041
==============================================================================
Omnibus:                    16811.972   Durbin-Watson:                   1.363
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           239302.462
Skew:                           2.388   Prob(JB):                         0.00
Kurtosis:                      15.948   Cond. No.                     7.88e+16
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 1.13e-28. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.</code></pre>
</div>
</div>
<div id="cell-67" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>model.params.index.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>array(['Intercept', 'C(NUTS3_TYPE)[T.Rural region]',
       'C(NUTS3_TYPE)[T.Urban region]', 'well_adapted', 'not_exposed',
       'very_exposed', 'Population', 'Gini', 'not_adapted', 'diff'],
      dtype=object)</code></pre>
</div>
</div>
<div id="cell-68" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the confidence interval as horizontal boxplots for each category for the OLS model</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> model.conf_int().loc[:, <span class="dv">1</span>]</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> model.conf_int().loc[:, <span class="dv">0</span>]</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> model.params.index.values</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> model.params.values</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># preds.index = preds.str.replace(' ', '\n')</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>ax.errorbar(preds, labels, xerr<span class="op">=</span>[preds <span class="op">-</span> lower, upper <span class="op">-</span> preds], fmt<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Coefficient'</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Variable'</span>)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'OLS Coefficients with 95% Confidence Intervals'</span>)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>ax.vlines(<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="bu">len</span>(labels), color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="multi_hazard_exposure_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="distance-to-cities" class="level3">
<h3 class="anchored" data-anchor-id="distance-to-cities">Distance to cities</h3>
</section>
<section id="wildfires-database" class="level3">
<h3 class="anchored" data-anchor-id="wildfires-database">Wildfires database</h3>
<div id="cell-72" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>wf_shp <span class="op">=</span> gpd.read_file(<span class="st">'../../data/shp_wildfires_europe/modis.ba.poly.shp'</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>wf_shp <span class="op">=</span> wf_shp[wf_shp.COUNTRY<span class="op">==</span><span class="st">'FR'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-73" class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>lau_2023 <span class="op">=</span> gpd.read_file(<span class="st">'../../data/LAU_2023_EU/LAU_RG_01M_2023_4326.shp'</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>lau_2023 <span class="op">=</span> lau_2023[lau_2023.CNTR_CODE<span class="op">==</span><span class="st">'FR'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-74" class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>wf_shp_agg <span class="op">=</span> gpd.sjoin(wf_shp, lau_2023, how<span class="op">=</span><span class="st">'left'</span>, op<span class="op">=</span><span class="st">'intersects'</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>wf_shp_agg[[<span class="st">'AREA_HA'</span>, <span class="st">'AREA_KM2'</span>]] <span class="op">=</span> wf_shp_agg[[<span class="st">'AREA_HA'</span>, <span class="st">'AREA_KM2'</span>]].astype(<span class="bu">float</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>wf_shp_agg[<span class="st">'FIREDATE'</span>] <span class="op">=</span> wf_shp_agg[<span class="st">'FIREDATE'</span>].<span class="bu">str</span>.split(<span class="st">' '</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>wf_shp_agg[<span class="st">'year_start'</span>] <span class="op">=</span> pd.to_datetime(wf_shp_agg[<span class="st">'FIREDATE'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>).dt.year</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>wf_shp_agg <span class="op">=</span> wf_shp_agg[[<span class="st">'AREA_HA'</span>, </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>                         , <span class="st">'geometry'</span>, <span class="st">'CNTR_CODE'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\colin\anaconda3\envs\xarray_env\Lib\site-packages\IPython\core\interactiveshell.py:3517: FutureWarning: The `op` parameter is deprecated and will be removed in a future release. Please use the `predicate` parameter instead.
  if await self.run_code(code, result, async_=asy):
C:\Users\colin\AppData\Local\Temp\ipykernel_51568\4061013874.py:1: UserWarning: CRS mismatch between the CRS of left geometries and the CRS of right geometries.
Use `to_crs()` to reproject one of the input geometries to match the CRS of the other.

Left CRS: GEOGCS["unknown",DATUM["WGS_1984",SPHEROID["WGS 84 ...
Right CRS: EPSG:4326

  wf_shp_agg = gpd.sjoin(wf_shp, lau_2023, how='left', op='intersects')</code></pre>
</div>
</div>
<div id="cell-75" class="cell" data-execution_count="185">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>wf_shp_agg[<span class="st">'before_2006'</span>] <span class="op">=</span> (wf_shp_agg[<span class="st">'year_start'</span>] <span class="op">&lt;</span> <span class="dv">2006</span>).astype(<span class="bu">int</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>wf_shp_agg[<span class="st">'noticeable'</span>] <span class="op">=</span> (wf_shp_agg[<span class="st">'AREA_HA'</span>] <span class="op">&gt;=</span> <span class="dv">10</span>).astype(<span class="bu">int</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>wf_shp_agg[<span class="st">'very_noticeable'</span>] <span class="op">=</span> (wf_shp_agg[<span class="st">'AREA_HA'</span>] <span class="op">&gt;=</span> <span class="dv">100</span>).astype(<span class="bu">int</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>wf_shp_agg[<span class="st">'id'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>wf_shp_final <span class="op">=</span> wf_shp_agg[[<span class="st">'LAU_ID'</span>,  <span class="st">'before_2006'</span>, <span class="st">'noticeable'</span>, <span class="st">'very_noticeable'</span>, <span class="st">'id'</span>]].groupby(<span class="st">'LAU_ID'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>wf_shp_final <span class="op">=</span> wf_shp_final.merge(lau_2023, left_on<span class="op">=</span><span class="st">'LAU_ID'</span>, right_on<span class="op">=</span><span class="st">'LAU_ID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-76" class="cell" data-execution_count="186">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>wf_shp_final[wf_shp_final.<span class="bu">id</span><span class="op">&gt;=</span><span class="dv">100</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="186">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LAU_ID</th>
<th data-quarto-table-cell-role="th">before_2006</th>
<th data-quarto-table-cell-role="th">noticeable</th>
<th data-quarto-table-cell-role="th">very_noticeable</th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">GISCO_ID</th>
<th data-quarto-table-cell-role="th">CNTR_CODE</th>
<th data-quarto-table-cell-role="th">LAU_NAME</th>
<th data-quarto-table-cell-role="th">POP_2023</th>
<th data-quarto-table-cell-role="th">POP_DENS_2</th>
<th data-quarto-table-cell-role="th">AREA_KM2</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1095</td>
<td>48116</td>
<td>0</td>
<td>68</td>
<td>1</td>
<td>163</td>
<td>FR_48116</td>
<td>FR</td>
<td>Pont de Montvert - Sud Mont Loz</td>
<td>562.0</td>
<td>NaN</td>
<td>3.353908</td>
<td>2023</td>
<td>POLYGON ((3.80298 44.41947, 3.80819 44.41832, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1229</td>
<td>64316</td>
<td>0</td>
<td>87</td>
<td>34</td>
<td>109</td>
<td>FR_64316</td>
<td>FR</td>
<td>Larrau</td>
<td>195.0</td>
<td>NaN</td>
<td>1.539112</td>
<td>2023</td>
<td>POLYGON ((-1.02551 43.05350, -1.01755 43.05156...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-77" class="cell" data-execution_count="191">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>lau_2023[lau_2023.LAU_ID.<span class="bu">str</span>.startswith(<span class="st">'34'</span>)].sort_values(<span class="st">'POP_2023'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="191">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">GISCO_ID</th>
<th data-quarto-table-cell-role="th">CNTR_CODE</th>
<th data-quarto-table-cell-role="th">LAU_ID</th>
<th data-quarto-table-cell-role="th">LAU_NAME</th>
<th data-quarto-table-cell-role="th">POP_2023</th>
<th data-quarto-table-cell-role="th">POP_DENS_2</th>
<th data-quarto-table-cell-role="th">AREA_KM2</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">31336</td>
<td>FR_34172</td>
<td>FR</td>
<td>34172</td>
<td>Montpellier</td>
<td>295542.0</td>
<td>NaN</td>
<td>5178.849187</td>
<td>2023</td>
<td>POLYGON ((3.85704 43.65352, 3.87128 43.64819, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96078</td>
<td>FR_34032</td>
<td>FR</td>
<td>34032</td>
<td>Béziers</td>
<td>78308.0</td>
<td>NaN</td>
<td>818.610810</td>
<td>2023</td>
<td>POLYGON ((3.27992 43.38842, 3.28191 43.38899, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30066</td>
<td>FR_34301</td>
<td>FR</td>
<td>34301</td>
<td>Sète</td>
<td>43858.0</td>
<td>NaN</td>
<td>1048.166865</td>
<td>2023</td>
<td>POLYGON ((3.66176 43.42451, 3.67238 43.43002, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44728</td>
<td>FR_34003</td>
<td>FR</td>
<td>34003</td>
<td>Agde</td>
<td>29600.0</td>
<td>NaN</td>
<td>582.725506</td>
<td>2023</td>
<td>POLYGON ((3.42897 43.29018, 3.43881 43.29872, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86607</td>
<td>FR_34145</td>
<td>FR</td>
<td>34145</td>
<td>Lunel</td>
<td>26385.0</td>
<td>NaN</td>
<td>1088.299304</td>
<td>2023</td>
<td>POLYGON ((4.13348 43.64110, 4.13342 43.64308, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">88076</td>
<td>FR_34303</td>
<td>FR</td>
<td>34303</td>
<td>Sorbs</td>
<td>38.0</td>
<td>NaN</td>
<td>1.864017</td>
<td>2023</td>
<td>POLYGON ((3.39522 43.86162, 3.38998 43.87621, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31722</td>
<td>FR_34238</td>
<td>FR</td>
<td>34238</td>
<td>Saint-André-de-Buèges</td>
<td>36.0</td>
<td>NaN</td>
<td>2.351641</td>
<td>2023</td>
<td>POLYGON ((3.67240 43.84152, 3.66438 43.84169, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31734</td>
<td>FR_34253</td>
<td>FR</td>
<td>34253</td>
<td>Saint-Félix-de-l'Héras</td>
<td>34.0</td>
<td>NaN</td>
<td>2.693843</td>
<td>2023</td>
<td>POLYGON ((3.35995 43.84772, 3.35634 43.84713, ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51744</td>
<td>FR_34072</td>
<td>FR</td>
<td>34072</td>
<td>Celles</td>
<td>27.0</td>
<td>NaN</td>
<td>3.560748</td>
<td>2023</td>
<td>POLYGON ((3.38577 43.66803, 3.38653 43.66126, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31715</td>
<td>FR_34231</td>
<td>FR</td>
<td>34231</td>
<td>Romiguières</td>
<td>21.0</td>
<td>NaN</td>
<td>5.934749</td>
<td>2023</td>
<td>POLYGON ((3.24392 43.80356, 3.23655 43.80540, ...</td>
</tr>
</tbody>
</table>

<p>342 rows × 9 columns</p>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>